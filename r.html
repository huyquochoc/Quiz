<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Redirect...</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial;
  background: #f6f7fb;
  text-align: center;
  padding-top: 60px;
}
.box {
  background: white;
  padding: 25px;
  max-width: 520px;
  margin: auto;
  border-radius: 12px;
  box-shadow: 0 10px 20px rgba(0,0,0,.08);
}
</style>
</head>

<body>
<div class="box">
  <h2 id="status">üîÑ ƒêang x·ª≠ l√Ω...</h2>
  <p id="msg"></p>
</div>

<script>
const JSON_URL = "https://huyquochoc.github.io/Quiz/shortlinks.json";

const params = new URLSearchParams(window.location.search);
const key = params.get("id");

const statusEl = document.getElementById("status");
const msgEl = document.getElementById("msg");

if (!key) {
  statusEl.textContent = "‚ùå Thi·∫øu m√£ truy c·∫≠p";
  msgEl.textContent = "Link kh√¥ng h·ª£p l·ªá";
  throw new Error("Missing id");
}

fetch(JSON_URL + "?t=" + Date.now())
  .then(r => r.json())
  .then(data => {
    if (!data[key]) {
      statusEl.textContent = "‚ùå Link kh√¥ng t·ªìn t·∫°i";
      msgEl.textContent = "M√£ link kh√¥ng h·ª£p l·ªá ho·∫∑c ƒë√£ b·ªã x√≥a";
      return;
    }

    const record = data[key];
    const url = record.url;
    const expire = record.expire;

    if (!url) {
      statusEl.textContent = "‚ùå L·ªói d·ªØ li·ªáu";
      msgEl.textContent = "Kh√¥ng t√¨m th·∫•y URL";
      return;
    }

    // ===== CHECK EXPIRE =====
    if (expire) {
      const today = new Date().toISOString().split("T")[0];
      if (today > expire) {
        statusEl.textContent = "‚õî Link ƒë√£ h·∫øt h·∫°n";
        msgEl.textContent = "Vui l√≤ng li√™n h·ªá gi√°o vi√™n";
        return;
      }
    }

    // ===== SHOW STATUS ONLY =====
    statusEl.textContent = "‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ";
    msgEl.textContent = "Vui l√≤ng ch·ªù trong gi√¢y l√°t";

    // ===== REDIRECT SILENT =====
    setTimeout(() => {
      window.location.replace(url);
    }, 700);
  })
  .catch(() => {
    statusEl.textContent = "‚ö†Ô∏è L·ªói t·∫£i d·ªØ li·ªáu";
    msgEl.textContent = "Kh√¥ng th·ªÉ t·∫£i shortlinks.json";
  });
</script>

</body>
</html>
